# w全局对象的API

浏览器环境的window对象仍然是可用的。框架在初始化的时候，会初始化全局对象w。

w上提供了一切框架环境运行期间的功能封装。在代码的任何位置，你都可以直接通过w.xx的形式访问属性或调用接口。

> 一般你只能在组件、页面、扩展的js文件中调用这些API。

> ----
> ## 路由和页面相关
> ----

### 跳转到页面：w.go

```javascript
//函数定义
w.go = function (path, args={}){}
```

示例：
```javascript
//url会变成 #user?id=12
w.go('user', {id: 12})
```

### 页面滚动： w.scroll

```javascript
//函数定义，参考MDN element.prototype.scroll文档。
w.scroll = function(x,y){}
```

示例：

```javascript
w.scroll(10, 100)
w.scroll({
    top: 100,
    left: 200,
    behaviro: 'smooth'
})
```

w.scrollTop()可以直接滚动到页面顶部。

### 返回上一页：w.goBack

此函数没有参数，如果检测到历史记录大于1才会返回，并且返回值为true，否则返回false。

### 重定向：w.redirect

```javascript
//函数定义
w.redirect = function(path, args={}){}
```

示例：

```javascript
w.redirect('home')
```

重定向会替换当前页面，不会产生新的历史记录。

**延迟重定向**

```javascript
//300毫秒后重定向到login页面
w.redirect('login', {delay:300})
```

延迟重定向针对不能立即执行的函数中，比如在下面要讲到的钩子函数，检测到未登录要重定向到login页面，但是要先返回false阻止继续加载页面，然后重定向。

### 重新加载页面：w.reload

此函数不必传参，直接调用：
```javascript
w.reload()
```

执行会先销毁当前页面，然后重新加载。


> ----
> ## 钩子函数：hooks
> ----

钩子函数是一种在加载页面之前要运行的函数，可以添加多个，一旦某个函数返回false则会终止对页面的加载。

### w.addHook

注册hook函数：

```javascript
w.addHook((ctx) => {
    //检测如果token失效则返回false
    if (!w.ext.checkToken()) {
        w.redirect('login', {delay:100});
        return false;
    }
}, {name: 'login-check', exclude: ['login', 'aboutus']});
//选项：钩子函数名字是login-check，exclude表示对login和aboutus页面不执行。
```

### w.removeHook

移除hook函数：

```javascript
//根据名字移除钩子函数
w.removeHook('login-check')

```

> ----
> ## 界面交互
> ----

### w.alert w.unalert

w.alert用于替换window.alert，并且你可以直接写alert，因为已经挂在到window.alert，替换掉了浏览器默认的。

w.unalert用于取消alert显示。

w.alert可以用于显示任何复杂的内容，除了信息提示，还可以是表单，info就是开发者拼接好的html文本。

```javascript
//函数定义
w.alert = function (info, options){}
```
**options选项**

- notClose 不显示关闭按钮。

- transparent 是否显示透明背景。

- replace 是否使用替换操作，默认是追加到已有信息的后面。

- withCover 是否显示一个遮罩层，遮罩层的目的是阻止其他操作。

alert会显示几条最近的文本，如果要在显示新的文本时，不显示已有的，请使用replace选项设置为true。

### w.acover

acover方法是对alert的封装。有对应的w.uncover方法是对unalert的封装。

### 消息通知：w.notify和相关封装

w.notify其实和alert实现了类似的功能，但是从默认样式，功能定位等都是不同的。这里有一个最核心的差异，就是二者是独立的DOM节点，相互不会有影响，对于复杂的应用，这是很有必要的。

**w.notify有对应的w.unnotify方法用于隐藏通知消息。**

notify的通知消息默认在右下角位置。

```javascript
//函数定义
w.notify = function(info, options){}

```

**options 选项**

- ntype

通知类型，字符串值，默认为notify，支持的值有：

`top error light only noclose`

并且你可以组合使用：

```javascript
//此选项表示：通知位置在顶部、错误消息类型、只显示此消息，清空之前的通知。
w.notify('<h2>消息</h2><p>这是消息</p>', {
    ntype: 'top error only'
})
```

<br>

- timeout

超时，默认为3500毫秒，超时后就会自动隐藏通知，这也是和alert一个大的区别，alert是需要手动关闭的。

